<div th:replace="/ViewLayout/header.html"></div>



<div class="p-5 bg-primary text-white text-center">
	<h1 th:text="${c.className}"></h1>
	<p>Chào mừng bạn tham gia vào lớp!</p>
</div>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
	<div class="container-fluid">
		<ul class="navbar-nav">
			<li class="nav-item"><a class="nav-link active"
				th:href="'/Class/enterClass/' + ${id}">Lobby</a></li>
			<li th:if="${c.account.accountId == session.loggedInUser.accountId}"
				class="nav-item dropdown"><a class="nav-link dropdown-toggle"
				href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
				aria-expanded="false"> Create </a>
				<ul class="dropdown-menu" aria-labelledby="navbarDropdown">
					<li><a id="createNotifyBtn" class="dropdown-item" href="#">Notify</a></li>
					<li><a id="createHomeworkBtn" class="dropdown-item" href="#">Homework</a></li>
				</ul></li>

			<li class="nav-item"><a class="nav-link"
				th:href="'/Homework/listHomework/' + ${id}">Homework</a></li>
			<li class="nav-item"><a class="nav-link"
				th:href="'/Notify/listNoti/' + ${id}">Notify</a></li>
			<li class="nav-item"><a class="nav-link disabled" href="#">Disabled</a>
			</li>
			<li th:if="${account.accountId != c.account.accountId}" class="nav-item"><a class="nav-link leave-class-btn" href="#" th:data-class-id="${c.classId}">Leave class</a>
			</li>
		</ul>
	</div>
</nav>
<!-- Tabs -->
<ul class="nav nav-tabs" id="homeworkTabs">
	<li class="nav-item"><a class="nav-link active" id="allTab"
		data-toggle="tab" href="#allContent">All</a></li>
	<li class="nav-item"><a class="nav-link" id="doneTab"
		data-toggle="tab" href="#doneContent">Complete</a></li>
	<li class="nav-item"><a class="nav-link" id="notDoneTab"
		data-toggle="tab" href="#notDoneContent">Not Done</a></li>
</ul>

<!-- Tab content -->
<div class="tab-content" id="homeworkTabContent">
	<!-- All Homework Content -->
	<div id="errorDiv" class="alert alert-danger" th:if="${errorEmptyFile}">
		<p th:text="${errorEmptyFile}"></p>
	</div>
	<div id="successDiv" class="alert alert-success" th:if="${createHomeworkSuccess}">
		<p th:text="${createHomeworkSuccess}"></p>
	</div>
	<div id="successDiv" class="alert alert-success" th:if="${updateHomeworkSuccess}">
		<p th:text="${updateHomeworkSuccess}"></p>
	</div>
	<div id="successDiv" class="alert alert-success" th:if="${submitHomeworkSuccess}">
		<p th:text="${submitHomeworkSuccess}"></p>
	</div>
	<div id="successDiv" class="alert alert-success" th:if="${updateSubmitHomeworkSuccess}">
		<p th:text="${updateSubmitHomeworkSuccess}"></p>
	</div>
	<div class="tab-pane fade show active" id="allContent">
		<div style="margin-left: 30px"
			class="container1 bootstrap snippets bootdey">
			<div class="table-responsive">
				<!-- PROJECT TABLE -->
				<table class="table colored-header datatable project-list">
					<thead>
						<tr>
							<th>Homework Name</th>
							<th>Date Start</th>

							<th>Done</th>
							<th>Deadline</th>

							<th>Status</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="homework : ${hw}">
							<td><a
								th:href="'/Homework/detailHomework/' + ${homework.homeworkId}"><span
									th:text="${homework.homeworkName}"></span></a></td>
							<td><p
									th:text="${#temporals.format(homework.dateCreated, 'dd/MM/yyyy HH:mm')}"></p></td>

							<td>
								<!-- Kiểm tra và xử lý nếu countSubmittedByHomeworkId hoặc countMember là null -->


								<input th:type="hidden"
								name="submittedCount[${homework.homeworkId}]"
								th:value="${countSubmittedByHomeworkId[homework.homeworkId] ?: 0}">

								<!-- Progress bar -->
								<div class="progress">
									<div class="progress-bar"
										th:if="${countSubmittedByHomeworkId[homework.homeworkId]} != null and ${countMember} != null"
										th:attr="data-transitiongoal=${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)}, aria-valuenow=${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)}"
										th:style="'width:' + (${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)}) + '%'">
										<span
											th:text="${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)} + '%'"></span>

									</div>
									<span
										th:if="${countSubmittedByHomeworkId[homework.homeworkId]} == null or ${countMember} == null"
										style="color: red;">0%</span>



								</div>
							</td>
							<td>
								<p th:if="${homework.deadline != null}"
									th:text="${#temporals.format(homework.deadline, 'dd/MM/yyyy')}"></p>
								<p th:unless="${homework.deadline != null}" th:text="None"></p>

							</td>

							<td><span class="label label-success"
								th:if="${(homework.deadline == null || homework.deadline.isAfter(T(java.time.LocalDate).now()))}">OPEN</span>
								<span class="label label-danger"
								th:unless="${(homework.deadline == null || homework.deadline.isAfter(T(java.time.LocalDate).now()))}">CLOSE</span>

							</td>
							<td>
								<div class="btn-group">
									<!-- Người tạo lớp -->
									<div
										th:if="${c.account.accountId == session.loggedInUser.accountId}">
										<a
											th:href="'/Homework/editHomework/' + ${homework.homeworkId}"
											class="btn btn-primary"> <span class="fa fa-pencil"></span>
											Edit
										</a> <a href="#" class="btn btn-danger"
											th:attr="onclick='confirmDeleteHomework(\'' + ${homework.homeworkId} + '\')'">
											<span class="fa fa-trash"></span> Delete
										</a> <a class="btn btn-primary"
											th:href="'/Homework/listMemberSubmited/' + ${homework.homeworkId}">Danh
											sách</a>

									</div>
									<!-- THành viên -->
									<div
										th:if="${c.account.accountId != session.loggedInUser.accountId}">
										<a id="submitHomeworkButton"
											th:data-deadline="${homework.deadline}"
											th:if="${!listSubmit.contains(homework.homeworkId)}"
											th:href="@{'/Homework/submitHomeWorkView/' + ${homework.homeworkId}}"
											class="btn btn-primary"> Nộp bài </a><a th:each="list : ${listSubmitHomework}"
											th:if="${list.account.accountId == session.loggedInUser.accountId 
	    			and list.homework.homeworkId == homework.homeworkId 
	    			and (homework.deadline == null || homework.deadline.isAfter(T(java.time.LocalDate).now()))}"
											th:href="'/Homework/editSubmitHomework/' + ${homework.homeworkId}" class="btn btn-primary btn-sm">
											<span class="fa fa-pencil"></span> Chỉnh sửa bài nộp
										</a>
									</div>

								</div>
							</td>
						</tr>





					</tbody>
				</table>
				<!-- END PROJECT TABLE -->
			</div>
		</div>
	</div>

	<!-- Done Homework Content -->
	<div class="tab-pane fade" id="doneContent">
		<div style="margin-left: 30px"
			class="container1 bootstrap snippets bootdey">
			<div class="table-responsive">
				<!-- PROJECT TABLE -->
				<table class="table colored-header datatable project-list">
					<thead>
						<tr>
							<th>Homework Name</th>
							<th>Date Start</th>

							<th>Done</th>
							<th>Deadline</th>

							<th>Status</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="homework : ${hw}"
							th:if="${listSubmit.contains(homework.homeworkId)}">
							<td><a
								th:href="'/Homework/detailHomework/' + ${homework.homeworkId}"><span
									th:text="${homework.homeworkName}"></span></a></td>
							<td><p
									th:text="${#temporals.format(homework.dateCreated, 'dd/MM/yyyy HH:mm')}"></p></td>

							<td>
								<!-- Kiểm tra và xử lý nếu countSubmittedByHomeworkId hoặc countMember là null -->


								<input th:type="hidden"
								name="submittedCount[${homework.homeworkId}]"
								th:value="${countSubmittedByHomeworkId[homework.homeworkId] ?: 0}">

								<!-- Progress bar -->
								<div class="progress">
									<div class="progress-bar"
										th:if="${countSubmittedByHomeworkId[homework.homeworkId]} != null and ${countMember} != null"
										th:attr="data-transitiongoal=${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)}, aria-valuenow=${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)}"
										th:style="'width:' + (${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)}) + '%'">
										<span
											th:text="${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)} + '%'"></span>

									</div>
									<span
										th:if="${countSubmittedByHomeworkId[homework.homeworkId]} == null or ${countMember} == null"
										style="color: red;">0%</span>



								</div>
							</td>
							<td>
								<p th:if="${homework.deadline != null}"
									th:text="${#temporals.format(homework.deadline, 'dd/MM/yyyy')}"></p>
								<p th:unless="${homework.deadline != null}" th:text="None"></p>

							</td>

							<td><span class="label label-success"
								th:if="${(homework.deadline == null || homework.deadline.isAfter(T(java.time.LocalDate).now()))}">OPEN</span>
								<span class="label label-danger"
								th:unless="${(homework.deadline == null || homework.deadline.isAfter(T(java.time.LocalDate).now()))}">CLOSE</span>

							</td>
							<td>
								<div class="btn-group">
									<!-- Người tạo lớp -->
									<div
										th:if="${c.account.accountId == session.loggedInUser.accountId}">
										<a
											th:href="'/Homework/editHomework/' + ${homework.homeworkId}"
											class="btn btn-primary"> <span class="fa fa-pencil"></span>
											Edit
										</a> <a href="#" class="btn btn-danger"
											th:attr="onclick='confirmDeleteHomework(\'' + ${homework.homeworkId} + '\')'">
											<span class="fa fa-trash"></span> Delete
										</a> <a class="btn btn-primary"
											th:href="'/Homework/listMemberSubmited/' + ${homework.homeworkId}">Danh
											sách</a>

									</div>
									<!-- THành viên -->
									<div
										th:if="${c.account.accountId != session.loggedInUser.accountId}">
										<a id="submitHomeworkButton"
											th:data-deadline="${homework.deadline}"
											th:if="${!listSubmit.contains(homework.homeworkId)}"
											th:href="@{'/Homework/submitHomeWorkView/' + ${homework.homeworkId}}"
											class="btn btn-primary"> Nộp bài </a> 
										<a th:each="list : ${listSubmitHomework}"
											th:if="${list.account.accountId == session.loggedInUser.accountId 
	    			and list.homework.homeworkId == homework.homeworkId 
	    			and (homework.deadline == null || homework.deadline.isAfter(T(java.time.LocalDate).now()))}"
											th:href="'/Homework/editSubmitHomework/' + ${homework.homeworkId}" class="btn btn-primary btn-sm">
											<span class="fa fa-pencil"></span> Chỉnh sửa bài nộp
										</a>
									</div>

								</div>
							</td>
						</tr>





					</tbody>
				</table>
				<!-- END PROJECT TABLE -->
			</div>
		</div>
	</div>

	<!-- Not Done Homework Content -->
	<div class="tab-pane fade" id="notDoneContent">
		<div style="margin-left: 30px"
			class="container1 bootstrap snippets bootdey">
			<div class="table-responsive">
				<!-- PROJECT TABLE -->
				<table class="table colored-header datatable project-list">
					<thead>
						<tr>
							<th>Homework Name</th>
							<th>Date Start</th>

							<th>Done</th>
							<th>Deadline</th>

							<th>Status</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="homework : ${hw}"
							th:if="${!listSubmit.contains(homework.homeworkId)}">
							<td><a
								th:href="'/Homework/detailHomework/' + ${homework.homeworkId}"><span
									th:text="${homework.homeworkName}"></span></a></td>
							<td><p
									th:text="${#temporals.format(homework.dateCreated, 'dd/MM/yyyy HH:mm')}"></p></td>

							<td>
								<!-- Kiểm tra và xử lý nếu countSubmittedByHomeworkId hoặc countMember là null -->


								<input th:type="hidden"
								name="submittedCount[${homework.homeworkId}]"
								th:value="${countSubmittedByHomeworkId[homework.homeworkId] ?: 0}">

								<!-- Progress bar -->
								<div class="progress">
									<div class="progress-bar"
										th:if="${countSubmittedByHomeworkId[homework.homeworkId]} != null and ${countMember} != null"
										th:attr="data-transitiongoal=${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)}, aria-valuenow=${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)}"
										th:style="'width:' + (${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)}) + '%'">
										<span
											th:text="${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)} + '%'"></span>

									</div>
									<span
										th:if="${countSubmittedByHomeworkId[homework.homeworkId]} == null or ${countMember} == null"
										style="color: red;">0%</span>



								</div>
							</td>
							<td>
								<p th:if="${homework.deadline != null}"
									th:text="${#temporals.format(homework.deadline, 'dd/MM/yyyy')}"></p>
								<p th:unless="${homework.deadline != null}" th:text="None"></p>

							</td>

							<td><span class="label label-success"
								th:if="${(homework.deadline == null || homework.deadline.isAfter(T(java.time.LocalDate).now()))}">OPEN</span>
								<span class="label label-danger"
								th:unless="${(homework.deadline == null || homework.deadline.isAfter(T(java.time.LocalDate).now()))}">CLOSE</span>

							</td>
							<td>
								<div class="btn-group">
									<!-- Người tạo lớp -->
									<div
										th:if="${c.account.accountId == session.loggedInUser.accountId}">
										<a
											th:href="'/Homework/editHomework/' + ${homework.homeworkId}"
											class="btn btn-primary"> <span class="fa fa-pencil"></span>
											Edit
										</a> <a href="#" class="btn btn-danger"
											th:attr="onclick='confirmDeleteHomework(\'' + ${homework.homeworkId} + '\')'">
											<span class="fa fa-trash"></span> Delete
										</a> <a class="btn btn-primary"
											th:href="'/Homework/listMemberSubmited/' + ${homework.homeworkId}">Danh
											sách</a>

									</div>
									<!-- THành viên -->
									<div
										th:if="${c.account.accountId != session.loggedInUser.accountId}">
										<a id="submitHomeworkButton"
											th:data-deadline="${homework.deadline}"
											th:if="${!listSubmit.contains(homework.homeworkId)}"
											th:href="@{'/Homework/submitHomeWorkView/' + ${homework.homeworkId}}"
											class="btn btn-primary"> Nộp bài </a> 
										<a th:each="list : ${listSubmitHomework}"
											th:if="${list.account.accountId == session.loggedInUser.accountId 
	    			and list.homework.homeworkId == homework.homeworkId 
	    			and (homework.deadline == null || homework.deadline.isAfter(T(java.time.LocalDate).now()))}"
											th:href="'/Homework/editSubmitHomework/' + ${homework.homeworkId}" class="btn btn-primary btn-sm">
											<span class="fa fa-pencil"></span> Chỉnh sửa bài nộp
										</a>
									</div>

								</div>
							</td>
						</tr>





					</tbody>
				</table>
				<!-- END PROJECT TABLE -->
			</div>
		</div>
	</div>
</div>

<style>
.container1 bootstrap snippets bootdey {
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
	font-size: 13px;
	color: #555;
	background: #ececec;
	margin-top: 20px;
}

.project-list>tbody>tr>td {
	padding: 12px 8px;
}

.project-list>tbody>tr>td .avatar {
	width: 22px;
	border: 1px solid #CCC;
}
</style>

<div id="updateSubmitHomeworkModal" class="modal">
	<div class="modal-dialog">
		<div class="modal-content">
			<!-- Modal Header -->
			<div class="modal-header">
				<h4 class="modal-title">Update SubmitHomework</h4>
				<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>
			<!-- Modal Body -->
			<div class="modal-body">
				<form id="updateSubmitHomeworkForm"
					action="/Homework/updateSubmitHomework" method="post"
					enctype="multipart/form-data">
					<input type="hidden" id="updateSubmitHomeworkId"
						name="submitHomeworkId">

					<div class="form-group">
						<label for="updateHomeworkDescription">Description:</label>
						<textarea class="form-control"
							id="updateSubmitHomeworkDescription" name="description"></textarea>
					</div>

					<div class="form-group mt-3">
						<label class="mr-2">Current Files:</label>
						<div>
							<ul id="fileList">

							</ul>


						</div>
					</div>
					<div class="form-group mt-3">
						<label class="mr-2">Upload your new file(Current file will
							be deleted):</label> <input type="file" name="filePath"
							multiple="multiple">
					</div>
					<button type="submit" class="btn btn-primary">Update</button>
				</form>
			</div>
		</div>
	</div>
</div>

<div id="homeworkModal" class="modal">
	<div class="modal-dialog">
		<div class="modal-content">

			<!-- Modal Header -->
			<div
				style="text-align: center; display: flex; justify-content: center;"
				class="modal-header">
				<h4 class="modal-title">Create Homework</h4>
			</div>

			<!-- Modal Body -->
			<div class="modal-body">
				<div class="alert alert-danger" th:if="${errorDeadline}">
					<p th:text="${errorDeadline}"></p>
				</div>
				<form action="/Homework/createHomework" id="homeworkForm"
					method="post" enctype="multipart/form-data">
					<div hidden="true" class="form-group">
						<label for="classes">Class</label> <select class="form-control"
							id="classes" name="classes">
							<!-- Iterate over the classes and populate the options -->
							<option th:value="${c.classId}" th:text="${c.className}"></option>
						</select>
					</div>
					<div class="form-group">
						<label for="homeworkName">Name:</label> <input name="homeworkName"
							type="text" class="form-control" id="homeworkName" required>
					</div>
					<div class="form-group">
						<label for="description">Description:</label>
						<textarea name="description" class="form-control"
							id="homeworkDescription" required></textarea>
					</div>
					<div class="form-group form-check">
						<input type="checkbox" class="form-check-input" id="status"
							onclick="toggleDeadline()"> <label
							class="form-check-label" for="status">Set deadline
							(Optional)</label>
					</div>
					<div class="form-group" id="deadlineGroup" style="display: none;">
						<label for="deadline">Deadline:</label> <input name="deadline"
							type="date" class="form-control" id="homeworkDeadline">
					</div>

					<div class="form-group mt-3">
						<label class="mr-2">Upload your homework:</label> <input
							type="file" name="filePath" multiple="multiple">
					</div>
					<div class="form-group mt-3 d-flex justify-content-between">
						<button type="button"
							class="btn btn-secondary closeCreateHomeworkModal"
							data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Create</button>
					</div>
				</form>
			</div>

		</div>
	</div>
</div>

<!-- Modals -->
<div id="notifyModal" class="modal">
	<div class="modal-dialog">
		<div class="modal-content">

			<!-- Modal Header -->
			<div
				style="text-align: center; display: flex; justify-content: center;"
				class="modal-header">
				<h4 class="modal-title">Create Notification</h4>
			</div>

			<!-- Modal Body -->
			<div class="modal-body">
				<form action="/Notify/createNotification" id="notifyForm"
					method="post" enctype="multipart/form-data">
					<div hidden="true" class="form-group">
						<label for="classes">Class</label> <select class="form-control"
							id="classes" name="classes">
							<!-- Iterate over the classes and populate the options -->
							<option th:value="${c.classId}" th:text="${c.className}"></option>
						</select>
					</div>
					<div class="form-group">
						<label for="title">Title:</label> <input type="text" name="title"
							class="form-control" id="notifyTitle" required />
					</div>
					<div class="form-group">
						<label for="content">Content:</label>
						<textarea name="content" class="form-control"
							id="notifyDescription" required></textarea>
					</div>

					<div class="form-group mt-3">
						<label class="mr-2">Upload your files(Optional):</label> <input
							type="file" name="filePath" multiple="multiple">
					</div>
					<div class="form-group mt-3 d-flex justify-content-between">
						<button type="button"
							class="btn btn-secondary closeCreateNotifyModal"
							data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Create</button>
					</div>

				</form>
			</div>

		</div>
	</div>
</div>
<!-- Notify -->
<script>
	document.getElementById('createNotifyBtn').addEventListener('click',
			function() {
				document.getElementById('notifyModal').style.display = 'block';
			});
	document.querySelectorAll('.closeCreateNotifyModal').forEach(function(el) {
		el.addEventListener('click', function() {
			document.getElementById('notifyModal').style.display = 'none';
		});
	});
</script>
<!-- Notify -->
<!-- Homework -->
<script>
	document
			.getElementById('createHomeworkBtn')
			.addEventListener(
					'click',
					function() {
						document.getElementById('homeworkModal').style.display = 'block';
					});
	document
			.querySelectorAll('.closeCreateHomeworkModal')
			.forEach(
					function(el) {
						el
								.addEventListener(
										'click',
										function() {
											document
													.getElementById('homeworkModal').style.display = 'none';
										});
					});
	function toggleDeadline() {
		var statusCheckbox = document.getElementById("status");
		var deadlineGroup = document.getElementById("deadlineGroup");

		if (statusCheckbox.checked) {
			deadlineGroup.style.display = "block"; // Hiển thị trường Deadline
		} else {
			deadlineGroup.style.display = "none"; // Ẩn trường Deadline
		}
	}
</script>

<script>
	function openUpdateSubmitHomeworkModal(homeworkId, homeworkDescription,
			file) {
		// Điền dữ liệu vào các trường trong modal
		document.getElementById('updateSubmitHomeworkId').value = homeworkId;

		document.getElementById('updateSubmitHomeworkDescription').value = homeworkDescription;

		// Mở modal
		$('#updateSubmitHomeworkModal').modal('show');
		document.querySelectorAll('.close').forEach(function(el) {
			el.addEventListener('click', function() {
				$('#updateSubmitHomeworkModal').modal('hide');
			});
		});

	};
</script>
<script>
	// Hàm để ẩn đi phần tử sau một khoảng thời gian
	function hideElementAfterDelay(elementId, delay) {
		setTimeout(function() {
			var element = document.getElementById(elementId);
			if (element) {
				element.style.display = 'none';
			}
		}, delay);
	}

	// Gọi hàm để ẩn đi phần tử sau 3 giây (3000 milliseconds)
	hideElementAfterDelay('errorDiv', 3000);
	hideElementAfterDelay('successDiv', 3000);
</script>
<div th:replace="/ViewLayout/footer.html"></div>







