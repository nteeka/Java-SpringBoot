<div th:replace="/ViewLayout/header.html"></div>



<div class="p-5 bg-primary text-white text-center">
	<h1>My First Bootstrap 5 Page</h1>
	<p>Resize this responsive page to see the effect!</p>
</div>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
	<div class="container-fluid">
		<ul class="navbar-nav">
			<li class="nav-item"><a class="nav-link active" th:href="'/Class/enterClass/' + ${id}">Lobby</a>
				</li>
			<li class="nav-item dropdown"><a
				class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
				role="button" data-bs-toggle="dropdown" aria-expanded="false">
					Create </a>
				<ul class="dropdown-menu" aria-labelledby="navbarDropdown">
					<li><a id="createNotifyBtn" class="dropdown-item" href="#">Notify</a></li>
					<li><a id="createHomeworkBtn" class="dropdown-item" href="#">Homework</a></li>
				</ul></li>
			<li class="nav-item dropdown"><a
				class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
				role="button" data-bs-toggle="dropdown" aria-expanded="false">
					List </a>
				<ul class="dropdown-menu" aria-labelledby="navbarDropdown">
					<li><a class="dropdown-item"
						th:href="'/Notify/listNoti/' + ${c.classId}">Notify</a></li>
					<li><a class="dropdown-item"
						th:href="'/Homework/listHomework/' + ${c.classId}">Homework</a></li>
				</ul></li>
			<li class="nav-item"><a class="nav-link disabled" href="#">Disabled</a>
			</li>
		</ul>
	</div>
</nav>

<div style="margin-left: 30px"
	class="container1 bootstrap snippets bootdey">
	<div class="table-responsive">
		<!-- PROJECT TABLE -->
		<table class="table colored-header datatable project-list">
			<thead>
				<tr>
					<th>Homework Name</th>
					<th>Date Start</th>

					<th>Done</th>
					<th>Deadline</th>

					<th>Status</th>
					<th>Action</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="homework : ${hw}">
					<td><a
						th:href="'/Homework/detailHomework/' + ${homework.homeworkId}"><span
							th:text="${homework.homeworkName}"></span></a></td>
					<td><p
							th:text="${#temporals.format(homework.dateCreated, 'dd/MM/yyyy HH:mm')}"></p></td>

					<td>
						<!-- Kiểm tra và xử lý nếu countSubmittedByHomeworkId hoặc countMember là null -->


						<input th:type="hidden"
						name="submittedCount[${homework.homeworkId}]"
						th:value="${countSubmittedByHomeworkId[homework.homeworkId] ?: 0}">

						<!-- Progress bar -->
						<div class="progress">
							<div class="progress-bar"
								th:if="${countSubmittedByHomeworkId[homework.homeworkId]} != null and ${countMember} != null"
								th:attr="data-transitiongoal=${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)}, aria-valuenow=${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)}"
								th:style="'width:' + (${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)}) + '%'">
								<span
									th:text="${countSubmittedByHomeworkId[homework.homeworkId] * 100 / (countMember - 1)} + '%'"></span>

							</div>
							<span
								th:if="${countSubmittedByHomeworkId[homework.homeworkId]} == null or ${countMember} == null"
								style="color: red;">0%</span>



						</div>
					</td>
					<td>
						<p th:if="${homework.deadline != null}"
							th:text="${#temporals.format(homework.deadline, 'dd/MM/yyyy')}"></p>
						<p th:unless="${homework.deadline != null}" th:text="None"></p>

					</td>

					<td><span class="label label-success"
						th:if="${(homework.deadline == null || homework.deadline.isAfter(T(java.time.LocalDate).now()))}">OPEN</span>
						<span class="label label-danger"
						th:unless="${(homework.deadline == null || homework.deadline.isAfter(T(java.time.LocalDate).now()))}">CLOSE</span>

					</td>
					<td>
						<div class="btn-group">
							<!-- Người tạo lớp -->
							<div
								th:if="${c.account.accountId == session.loggedInUser.accountId}">
								<a th:href="'/Homework/editHomework/' + ${homework.homeworkId}"
									class="btn btn-primary"> <span class="fa fa-pencil"></span>
									Edit
								</a> <a href="#" class="btn btn-danger"
									th:attr="onclick='confirmDeleteHomework(\'' + ${homework.homeworkId} + '\')'">
									<span class="fa fa-trash"></span> Delete
								</a> <a class="btn btn-primary"
									th:href="'/Homework/listMemberSubmited/' + ${homework.homeworkId}">Danh
									sách</a>

							</div>
							<!-- THành viên -->
							<div
								th:if="${c.account.accountId != session.loggedInUser.accountId}">
								<a id="submitHomeworkButton"
									th:data-deadline="${homework.deadline}"
									th:if="${!listSubmit.contains(homework.homeworkId)}"
									th:href="@{'/Homework/submitHomeWorkView/' + ${homework.homeworkId}}"
									class="btn btn-primary"> Nộp bài </a> <a
									th:each="list : ${listSubmitHomework}"
									th:if="${list.account.accountId == session.loggedInUser.accountId 
	    			and list.homework.homeworkId == homework.homeworkId 
	    			and (homework.deadline == null || homework.deadline.isAfter(T(java.time.LocalDate).now()))}"
									href="#" class="btn btn-primary btn-sm" data-toggle="modal"
									data-target="#updateSubmitHomeworkModal"
									th:attr="onclick='openUpdateSubmitHomeworkModal(\'' + ${list.submitHomeworkId} + '\', \'' + ${list.description} + '\', \'' + ${list.filePath} + '\')'">
									<span class="fa fa-pencil"></span> Chỉnh sửa bài nộp
								</a>
							</div>

						</div>
					</td>
				</tr>





			</tbody>
		</table>
		<!-- END PROJECT TABLE -->
	</div>
</div>
<style>
.container1 bootstrap snippets bootdey {
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
	font-size: 13px;
	color: #555;
	background: #ececec;
	margin-top: 20px;
}

.project-list>tbody>tr>td {
	padding: 12px 8px;
}

.project-list>tbody>tr>td .avatar {
	width: 22px;
	border: 1px solid #CCC;
}
</style>

<div id="updateSubmitHomeworkModal" class="modal">
	<div class="modal-dialog">
		<div class="modal-content">
			<!-- Modal Header -->
			<div class="modal-header">
				<h4 class="modal-title">Update SubmitHomework</h4>
				<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>
			<!-- Modal Body -->
			<div class="modal-body">
				<form id="updateSubmitHomeworkForm" action="/Homework/updateSubmitHomework" method="post" enctype="multipart/form-data">
					<input type="hidden" id="updateSubmitHomeworkId" name="submitHomeworkId">
					
					<div class="form-group">
						<label for="updateHomeworkDescription">Description:</label>
						<textarea class="form-control" id="updateSubmitHomeworkDescription" name="description"></textarea>
					</div>
					
					<div class="form-group mt-3">
						<label class="mr-2">Current Files:</label>
						<div>
							<ul id="fileList">
					            
        					</ul>
							
						    
						</div>
					</div>
					<div class="form-group mt-3">
						<label class="mr-2">Upload your new file(Current file will be deleted):</label>
						<input type="file" name="filePath" multiple="multiple">
					</div>											
					<button type="submit" class="btn btn-primary">Update</button>
				</form>
			</div>
		</div>
	</div>											
</div>
<script>
	function openUpdateSubmitHomeworkModal(homeworkId, homeworkDescription,
			file) {
		// Điền dữ liệu vào các trường trong modal
		document.getElementById('updateSubmitHomeworkId').value = homeworkId;

		document.getElementById('updateSubmitHomeworkDescription').value = homeworkDescription;
		// Thêm các file vào danh sách
		const fileList = document.getElementById('fileList');
		file.forEach(function(fileUrl) {
			var listItem = document.createElement('li');
			listItem.setAttribute('th:each', 'fileUrl : ${listFile}');
			listItem.setAttribute('th:if',
					'${fileUrl.submitHomework.submitHomeworkId == '
							+ submitHomeworkId + '}');

			var link = document.createElement('a');
			link.setAttribute('th:href', fileUrl);
			var span = document.createElement('span');
			span.setAttribute('th:text', fileUrl);
			link.appendChild(span);
			listItem.appendChild(link);
			fileList.appendChild(listItem);
		});

		// Mở modal
		$('#updateSubmitHomeworkModal').modal('show');
		document.querySelectorAll('.close').forEach(function(el) {
			el.addEventListener('click', function() {
				$('#updateSubmitHomeworkModal').modal('hide');
			});
		});

	};
</script>
<div th:replace="/ViewLayout/footer.html"></div>
