<div th:replace="/ViewLayout/header.html"></div>



<style>
.fakeimg {
	height: 200px;
	background: #aaa;
}
</style>
<div class="p-5 bg-primary text-white text-center">
	<h1 th:text="${c.className}"></h1>
	<p>Chào mừng bạn tham gia vào lớp!</p>
</div>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
	<div class="container-fluid">
		<ul class="navbar-nav">
			<li class="nav-item"><a class="nav-link active"
				th:href="'/Class/enterClass/' + ${id}">Lobby</a></li>
			<li th:if="${c.account.accountId == session.loggedInUser.accountId}"
				class="nav-item dropdown"><a class="nav-link dropdown-toggle"
				href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
				aria-expanded="false"> Create </a>
				<ul class="dropdown-menu" aria-labelledby="navbarDropdown">
					<li><a id="createNotifyBtn" class="dropdown-item" href="#">Notify</a></li>
					<li><a id="createHomeworkBtn" class="dropdown-item" href="#">Homework</a></li>
				</ul></li>

			<li class="nav-item"><a class="nav-link"
				th:href="'/Homework/listHomework/' + ${id}">Homework</a></li>
			<li class="nav-item"><a class="nav-link"
				th:href="'/Notify/listNoti/' + ${id}">Notify</a></li>
			<li class="nav-item"><a class="nav-link disabled" href="#">Disabled</a>
			</li>
			<li th:if="${account.accountId != c.account.accountId}"
				class="nav-item"><a class="nav-link leave-class-btn" href="#"
				th:data-class-id="${c.classId}">Leave class</a></li>

		</ul>
	</div>
</nav>


<div class="container mt-5">
	<div class="row">
		<div class="col-sm-4">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title">
						Class ID : <span class="card-text" th:text="${id}"
							th:data-id="${id}"></span>
					</h5>

					<button class="btn btn-primary" id="copyButton">Copy ID</button>
				</div>
			</div>

			<script
				src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
			<script>
				var clipboard = new ClipboardJS('#copyButton', {
					text : function() {
						var id = document.querySelector('.card-text')
								.getAttribute('data-id');
						return id;
					}
				});

				clipboard.on('success', function(e) {
					// Hiển thị thông báo
					alert("Copy id class thành công");
					// Nếu bạn muốn thêm một hộp thoại thông báo hoặc hiển thị thông báo tại một vị trí cụ thể, bạn có thể sử dụng thư viện thông báo khác như Toast.js hoặc Modal.

					// Ngừng sự kiện mặc định (chẳng hạn nhấp vào liên kết)
					e.clearSelection();
				});

				clipboard.on('error', function(e) {
					console.error('Action:', e.action);
					console.error('Trigger:', e.trigger);
				});
			</script>

			<h2>About Me</h2>
			<h5>Photo of me:</h5>
			<div class="fakeimg">
				<img style="width: 100%; height: 100%;" th:src="${c.account.image}"
					alt="Created">
			</div>
			<p th:text="${c.account.bio}"></p>

			<h3 class="mt-4">Some Class you already joined</h3>
			<p>Lorem ipsum dolor sit ame.</p>
			<div class="scrollable-list">
				<ul class="nav nav-pills flex-column">
					<li th:each="class : ${classes}" class="nav-item"><a
						th:href="'/Class/enterClass/' + ${class.classId}" class="nav-link"><span
							th:text="${class.className}"></span></a></li>
				</ul>
			</div>


			<h3 class="mt-4">
				List member joined(<span th:text="${countMember}"></span>)
			</h3>

			<input type="text" id="searchInput" placeholder="Search..."
				onkeyup="searchAccounts()">
			<div class="scrollable-listAccount">

				<ul id="accountList" class="list-unstyled">
					<li th:each="account : ${listAccount}"><span
						th:text="${account.displayName}"></span></li>
				</ul>
			</div>











			<hr class="d-sm-none">
			<a href="#" class="leave-class-btn" th:data-class-id="${c.classId}">Leave
				Class</a>

		</div>
		<div class="col-sm-8">
			<div th:if="${listPinnedNoti}" th:each="noti : ${listPinnedNoti}">
				<h2 class="mt-2" th:text="${noti.title}"></h2>
				<h5
					th:text="${#temporals.format(noti.dateCreated, 'MMM dd, yyyy HH:mm')}"></h5>
				<p th:if="${noti.lastModifed}">
					Last modified • <span
						th:text="${#temporals.format(noti.lastModifed, 'MMM dd, yyyy HH:mm')}"></span>
				</p>
				<div class="fakeimg">Fake Image</div>
				<p>Some text..</p>
				<p th:text="${noti.content}"></p>
			</div>
			
			<div th:unless="${listPinnedNoti}">
				<h2>TITLE NOTIFICATION</h2>
				<h5>Title description, Dec 7, 2020</h5>
				<div class="fakeimg">Fake Image</div>
				<p>Some text..</p>
				<p>Sunt in culpa qui officia deserunt mollit anim id est laborum
					consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
					labore et dolore magna aliqua. Ut enim ad minim veniam, quis
					nostrud exercitation ullamco.</p>
			</div>
		</div>

	</div>
</div>

<!-- Modals -->
<div id="notifyModal" class="modal">
	<div class="modal-dialog">
		<div class="modal-content">

			<!-- Modal Header -->
			<div
				style="text-align: center; display: flex; justify-content: center;"
				class="modal-header">
				<h4 class="modal-title">Create Notification</h4>
			</div>

			<!-- Modal Body -->
			<div class="modal-body">
				<form action="/Notify/createNotification" id="notifyForm"
					method="post" enctype="multipart/form-data">
					<div hidden="true" class="form-group">
						<label for="classes">Class</label> <select class="form-control"
							id="classes" name="classes">
							<!-- Iterate over the classes and populate the options -->
							<option th:value="${c.classId}" th:text="${c.className}"></option>
						</select>
					</div>
					<div class="form-group">
						<label for="title">Title:</label> <input type="text" name="title"
							class="form-control" id="notifyTitle" required />
					</div>
					<div class="form-group">
						<label for="content">Content:</label>
						<textarea name="content" class="form-control"
							id="notifyDescription" required></textarea>
					</div>

					<div class="form-group mt-3">
						<label class="mr-2">Upload your files(Optional):</label> <input
							type="file" name="filePath" multiple="multiple">
					</div>
					<div class="form-group mt-3 d-flex justify-content-between">
						<button type="button"
							class="btn btn-secondary closeCreateNotifyModal"
							data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Create</button>
					</div>

				</form>
			</div>

		</div>
	</div>
</div>

<div id="homeworkModal" class="modal">
	<div class="modal-dialog">
		<div class="modal-content">

			<!-- Modal Header -->
			<div
				style="text-align: center; display: flex; justify-content: center;"
				class="modal-header">
				<h4 class="modal-title">Create Homework</h4>
			</div>

			<!-- Modal Body -->
			<div class="modal-body">
				<div class="alert alert-danger" th:if="${errorDeadline}">
					<p th:text="${errorDeadline}"></p>
				</div>
				<form action="/Homework/createHomework" id="homeworkForm"
					method="post" enctype="multipart/form-data">
					<div hidden="true" class="form-group">
						<label for="classes">Class</label> <select class="form-control"
							id="classes" name="classes">
							<!-- Iterate over the classes and populate the options -->
							<option th:value="${c.classId}" th:text="${c.className}"></option>
						</select>
					</div>
					<div class="form-group">
						<label for="homeworkName">Name:</label> <input name="homeworkName"
							type="text" class="form-control" id="homeworkName" required>
					</div>
					<div class="form-group">
						<label for="description">Description:</label>
						<textarea name="description" class="form-control"
							id="homeworkDescription" required></textarea>
					</div>
					<div class="form-group form-check">
						<input type="checkbox" class="form-check-input" id="status"
							onclick="toggleDeadline()"> <label
							class="form-check-label" for="status">Set deadline
							(Optional)</label>
					</div>
					<div class="form-group" id="deadlineGroup" style="display: none;">
						<label for="deadline">Deadline:</label> <input name="deadline"
							type="date" class="form-control" id="homeworkDeadline">
					</div>

					<div class="form-group mt-3">
						<label class="mr-2">Upload your homework:</label> <input
							type="file" name="filePath" multiple="multiple">
					</div>
					<div class="form-group mt-3 d-flex justify-content-between">
						<button type="button"
							class="btn btn-secondary closeCreateHomeworkModal"
							data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Create</button>
					</div>
				</form>
			</div>

		</div>
	</div>
</div>

<!-- Modals -->

<!-- Scripts -->


<!-- Notify -->
<script>
	document.getElementById('createNotifyBtn').addEventListener('click',
			function() {
				document.getElementById('notifyModal').style.display = 'block';
			});
	document.querySelectorAll('.closeCreateNotifyModal').forEach(function(el) {
		el.addEventListener('click', function() {
			document.getElementById('notifyModal').style.display = 'none';
		});
	});
</script>
<!-- Notify -->

<!-- Homework -->
<script>
	document
			.getElementById('createHomeworkBtn')
			.addEventListener(
					'click',
					function() {
						document.getElementById('homeworkModal').style.display = 'block';
					});
	document
			.querySelectorAll('.closeCreateHomeworkModal')
			.forEach(
					function(el) {
						el
								.addEventListener(
										'click',
										function() {
											document
													.getElementById('homeworkModal').style.display = 'none';
										});
					});
	function toggleDeadline() {
		var statusCheckbox = document.getElementById("status");
		var deadlineGroup = document.getElementById("deadlineGroup");

		if (statusCheckbox.checked) {
			deadlineGroup.style.display = "block"; // Hiển thị trường Deadline
		} else {
			deadlineGroup.style.display = "none"; // Ẩn trường Deadline
		}
	}
</script>
<script th:inline="javascript">
	/*<![CDATA[*/
	/* Thymeleaf variable to check if there is an error */
	var hasError = /*[[${errorDeadline != null}]]*/false;

	/* If there is an error, show the modal again */
	if (hasError) {
		$(document).ready(function() {
			$('#homeworkModal').modal('show');
		});
	}
	/*]]>*/
	
	// Lấy tất cả các phần tử có class là leave-class-btn
	const leaveButtons = document.querySelectorAll('.leave-class-btn');
	leaveButtons.forEach(button => {
		button.addEventListener('click', function() {
		if (confirm("Are you sure you want to leave this class?")) {
			const classId = button.getAttribute('data-class-id');
			window.location.href = '/Class/leaveClass/' + classId;
		}
	});
});
</script>
<script>
    function searchAccounts() {
        // Lấy giá trị nhập vào từ ô tìm kiếm
        var input, filter, ul, li, i, txtValue;
        input = document.getElementById("searchInput");
        filter = input.value.toUpperCase();
        ul = document.getElementById("accountList");
        li = ul.getElementsByTagName("li");

        // Lặp qua tất cả các mục trong danh sách và ẩn những mục không khớp với tìm kiếm
        for (i = 0; i < li.length; i++) {
            txtValue = li[i].textContent || li[i].innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                li[i].style.display = "";
            } else {
                li[i].style.display = "none";
            }
        }
    }
</script>
<!-- Homework -->
<!-- Other -->
<style>
.scrollable-list {
	max-height: calc(7 * ( 1.5rem + 1px));
	/* Tính toán chiều cao tối đa cho 4 dòng */
	overflow-y: auto; /* Hiển thị thanh cuộn dọc khi cần thiết */
}
</style>
<style>
/* Đặt chiều cao tối đa cho danh sách là 3 dòng và kích hoạt thanh cuộn khi cần thiết */
.scrollable-listAccount {
	max-height: calc(3 * ( 1.5rem + 1px));
	/* 3 dòng * 3em (giả sử mỗi dòng có độ cao 3em) */
	overflow-y: auto;
}
</style>
<div th:replace="/ViewLayout/footer.html"></div>