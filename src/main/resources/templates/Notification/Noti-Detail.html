<div th:replace="/ViewLayout/header.html"></div>





    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">


<div class="max-w-2xl px-6 py-16 mx-auto space-y-12">
	<article class="space-y-8 dark:bg-gray-100 dark:text-gray-900">
		<div class="space-y-6">
			<h1 class="text-4xl font-bold md:tracking-tight md:text-5xl" th:text="${noti.title}"></h1>
			<div class="flex flex-col items-start justify-between w-full md:flex-row md:items-center dark:text-gray-600">
				<div class="flex items-center md:space-x-2">
					<img th:src="${account.image}" alt="" class="w-4 h-4 border rounded-full dark:bg-gray-500 dark:border-gray-300">
					<p class="text-sm"><span th:text="${noti.account.displayName}"></span> • <span th:text="${noti.account.displayName}"></span> <span
								th:text="${#temporals.format(noti.dateCreated, 'MMM,dd yyyy HH:mm')}"></span></p>
				</div>
				<p th:if="${noti.lastModifed}" class="flex-shrink-0 mt-3 text-sm md:mt-0">Last modified • <span th:text="${#temporals.format(noti.lastModifed, 'MMM, dd yyyy HH:mm')}"></span></p>
			</div>
		</div>
		<div class="dark:text-gray-800">
			<p th:text="${noti.content}"></p>
		</div>
	</article>
	<div>
		<div class="flex flex-wrap py-6 gap-2 border-t border-dashed dark:border-gray-600">
			<a rel="noopener noreferrer" href="#" class="px-3 py-1 rounded-sm hover:underline dark:bg-violet-600 dark:text-gray-50">#MambaUI</a>
			<a rel="noopener noreferrer" href="#" class="px-3 py-1 rounded-sm hover:underline dark:bg-violet-600 dark:text-gray-50">#TailwindCSS</a>
			<a rel="noopener noreferrer" href="#" class="px-3 py-1 rounded-sm hover:underline dark:bg-violet-600 dark:text-gray-50">#Angular</a>
		</div>
		<div th:if="${listFile}" class="space-y-2">
			<h4 class="text-lg font-semibold">Files attach</h4>		
			<ul class="ml-4 space-y-1 list-disc">
				<li th:each="fileName : ${listFile}">
					<a rel="noopener noreferrer" th:href="${fileName.filePath}" th:text="${fileName.filePath.replaceFirst('.*_Notify_', '')}" class="hover:underline"></a>
				</li>
				
			</ul>
		</div>
	</div>
</div>


						

						
	<div style="margin-left: 50px">
    <h4>Leave a Comment:</h4>
    <form role="form" action="/Comment/createNotifyComment" method="post">
        <div class="form-group">
            <input name="notify" th:value="${noti.notifyId}" hidden="true" class="form-control" rows="3" required />
        </div>
        <div class="form-group">
            <textarea name="content" class="form-control" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-success">Submit</button>
    </form>
    <br>
    <br>
    <p>
        <span th:text="${noti.numComment}"></span>
        Comments
    </p>
    <br>
    <div class="space-y-4">
        <div th:each="cmt : ${listComment}" th:if="${noti.notifyId == cmt.notify.notifyId}" class="comment">
            <div class="flex space-x-4">
                <img th:src="${cmt.account.image}" class="w-12 h-12 rounded-full" alt="Avatar">
                <div class="flex-1">
                    <div class="flex justify-between">
                        <h4 class="font-bold" th:text="${cmt.account.displayName}"></h4>
                        <p class="text-sm" th:text="${#temporals.format(cmt.dateCreated, 'dd/MM/yyyy HH:mm')}"></p>
                    </div>
                    
                    <p class="original-content" th:text="${cmt.content}"></p>
                    <textarea class="edit-content" style="display: none;"></textarea>
                    
                    <div class="flex items-center space-x-2">
                    	<a href="#"
											th:if="${#lists.contains(checkLikeComment, cmt.commentId)}"
											th:id="'likeButton_' + ${cmt.commentId}"
											th:data-comment-id="${cmt.commentId}" class="like-btn liked"
											th:attr="onclick='toggleLike(\'' + ${cmt.commentId} + '\', event)'">
											<i class="fa fa-thumbs-up"></i>Liked<span
											th:if="${cmt.likeNumber != null or cmt.likeNumber != 0}">(</span><span
											th:if="${cmt.likeNumber != null or cmt.likeNumber != 0}"
											th:text="${cmt.likeNumber}"></span><span
											th:if="${cmt.likeNumber != null or cmt.likeNumber != 0}">)</span>
										</a> <a href="#"
											th:unless="${#lists.contains(checkLikeComment, cmt.commentId)}"
											th:id="'likeButton_' + ${cmt.commentId}"
											th:data-comment-id="${cmt.commentId}" class="like-btn"
											th:attr="onclick='toggleLike(\'' + ${cmt.commentId} + '\', event)'">
											<i class="fa fa-thumbs-up"></i>Like<span
											th:if="${cmt.likeNumber != null or cmt.likeNumber != 0}">(</span><span
											th:if="${cmt.likeNumber != null or cmt.likeNumber != 0}"
											th:text="${cmt.likeNumber}"></span><span
											th:if="${cmt.likeNumber != null or cmt.likeNumber != 0}">)</span>
										</a>
										<a
											th:if="${cmt.account.accountId == session.loggedInUser.accountId}"
											th:data-comment-id="${cmt.account.email}" href="#"
											class="edit-btn"> <i class="fa fa-pencil"></i> Edit
										</a> <a href="#" class="save-btn" style="display: none;"
											th:data-comment-id="${cmt.commentId}"><i
											class="fa fa-save"></i> Save</a> <a href="#" class="cancel-btn"
											style="display: none;">Cancel</a> <a href="#"
											th:if="${cmt.account.accountId == session.loggedInUser.accountId }"
											th:attr="onclick='confirmDeleteComment(\'' + ${cmt.commentId} + '\')'"><i
											class="fa fa-trash"></i>Delete</a> <a href="#" class="reply-btn">Reply</a>
										<form th:action="@{/Comment/createReplyComment}" method="post"
											class="reply-form" style="display: none;">
											<input name="comment" th:value="${cmt.commentId}"
												hidden="true" class="form-control" />
											<textarea name="content" class="reply-content" rows="3"
												required></textarea>
											<button type="submit" class="btn btn-primary">Submit</button>
											<!-- Thêm nút Cancel -->
											<button type="button" class="btn btn-secondary cancell-btn">Cancel</button>
										</form>
                    </div>
                </div>
            </div>
            <div class="space-y-4 ml-16">
                <div th:each="reply : ${listReply}" th:if="${reply.comment.commentId == cmt.commentId}" class="reply">
                    <div style="margin-top: 10px" class="flex space-x-4">
                        <img th:src="${reply.account.image}" class="w-10 h-10 rounded-full" alt="Avatar">
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h4 class="font-bold" th:text="${reply.account.displayName}"></h4>
                                <p class="text-sm" th:text="${#temporals.format(reply.dateCreated, 'dd/MM/yyyy HH:mm')}"></p>
                            </div>
                            <p class="text-gray-800" th:text="${reply.content}"></p>
                            <div class="flex items-center space-x-2">
                               	<a href="#"><span class="fa fa-thumbs-up"></span>Like</a> <a
													href="#"><span class="fa fa-pencil"></span>Edit</a> <a
													href="#"><span class="fa fa-trash"></span>Delete</a>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
					





<script>
	    function confirmDelete(notifyId) {
	        var result = confirm("Are you sure you want to delete this notify?");
	        if (result) {
	            // User clicked 'Yes', redirect to the delete URL
	            window.location.href = "/Teacher/deleteNoti/" + notifyId;
	        } else {
	            // User clicked 'No', do nothing
	        }
	    }
	</script>				
						
										<script th:inline="javascript">			    
				    function toggleLike(commentId, event) {
				        event.preventDefault(); // Ngăn chặn hành vi mặc định của thẻ <a>			        
				        var likeButton = document.getElementById('likeButton_' + commentId);
				        var isLiked = likeButton.classList.contains('liked');			        
				        fetch('/Comment/likeComment/' + commentId, { method: 'GET' })
				        .then(response => {
				            if (!response.ok) {
				                throw new Error('Failed to like/unlike comment');
				            }			            
				            // Thay đổi nút từ Like sang Liked và ngược lại
				            if (isLiked) {
				                likeButton.innerHTML = '<i class="fa fa-thumbs-up"></i>Like';
				                likeButton.classList.remove('liked');
				            } else {
				                likeButton.innerHTML = '<i class="fa fa-thumbs-up"></i>Liked';
				                likeButton.classList.add('liked');
				            }			            
				            console.log('Comment like/unlike successful');
				        })
				        .catch(error => {
				            console.error('Error:', error);
				        });
				    }			
				</script>
										
										<script>
	    function confirmDeleteComment(commentId) {
	        var result = confirm("Are you sure you want to delete this comment?");
	        if (result) {
	            // User clicked 'Yes', redirect to the delete URL
	            window.location.href = "/Comment/deleteComment/" + commentId;
	        } else {
	            // User clicked 'No', do nothing
	        }
	    }
	</script>
										<script>
    $(document).ready(function() {
        $('.reply-btn').click(function(event) {
            event.preventDefault(); // Ngăn chặn hành vi mặc định của thẻ <a>

            // Hiển thị form Reply tương ứng
            var $comment = $(this).closest('.comment');
            $comment.find('.reply-form').show();
            $comment.find('.reply-content').focus();
        });

        // Ẩn form khi nhấn nút Cancel
        $('.cancell-btn').click(function(event) {
            event.preventDefault();
            var $comment = $(this).closest('.comment');
            $comment.find('.reply-form').hide();
        });
    });

    // Hàm gửi dữ liệu reply comment lên server bằng Ajax
    function createReplyComment(content, commentId) {
        $.ajax({
            type: 'POST',
            url: '/Comment/createReplyComment',
            data: { content: content, commentId: commentId },
            success: function(response) {
                // Xử lý sau khi reply comment được tạo thành công (nếu cần)
                console.log('Reply comment created successfully');
                // Có thể làm mới danh sách comment ở đây nếu cần
            },
            error: function(xhr, status, error) {
                // Xử lý lỗi nếu có
                console.error('Error creating reply comment:', error);
            }
        });
    }
</script>


							<script>
	$(document).ready(function() {
	    $('.edit-btn').click(function(event) {
	        event.preventDefault(); // Ngăn chặn hành vi mặc định của liên kết
	        // Ẩn nội dung ban đầu và hiển thị textarea để chỉnh sửa
	        var $comment = $(this).closest('.comment');
	        $comment.find('.original-content').hide();
	        $comment.find('.edit-content').show().val($comment.find('.original-content').text().trim()).focus();
	        $comment.find('.save-btn').show();
	        $comment.find('.cancel-btn').show();
	    });
		
	    $('.cancel-btn').click(function(event) {
	        event.preventDefault(); // Ngăn chặn hành vi mặc định của liên kết
	        var $comment = $(this).closest('.comment');
	        $comment.find('.original-content').show();
	        $comment.find('.edit-content').hide();   
	        $comment.find('.cancel-btn').hide();
	        $comment.find('.save-btn').hide();
	    });
	    
	    
	    $('.save-btn').click(function(event) {
	        event.preventDefault(); // Ngăn chặn hành vi mặc định của liên kết
	        var $comment = $(this).closest('.comment');
	        var commentId = $(this).data('comment-id');
	        var updatedContent = $comment.find('.edit-content').val().trim();
	
	        // Gửi yêu cầu cập nhật nội dung bình luận bằng Ajax
	        $.ajax({
	            type: 'POST',
	            url: '/Comment/updateComment/' + commentId,
	            data: { taskName: updatedContent },
	            success: function(response) {
	                // Xử lý phản hồi từ máy chủ nếu cần
	                // Ví dụ: Hiển thị thông báo hoặc làm mới danh sách bình luận
	                console.log('Comment updated successfully');
	                // Ẩn textarea chỉnh sửa và hiển thị lại nội dung mới
	                $comment.find('.edit-content').hide();
	                $comment.find('.original-content').text(updatedContent).show();
	                // Ẩn nút Save
	                $comment.find('.save-btn').hide();
	            },
	            error: function(xhr, status, error) {
	                // Xử lý lỗi nếu cần
	                console.error('Error updating comment:', error);
	            }
	        });
	    });
	});
	</script>



<div th:replace="/ViewLayout/footer.html"></div>
