<div th:replace="/ViewLayout/header.html"></div>


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<div class="container-fluid">
    <div class="row content">
        <div class="col-sm-2 sidenav">
            <h4>John's Blog</h4>
            <!-- List of cards -->
            <div class="card">
                <div class="card-header">
                    Featured
                </div>
                <ul class="list-group list-group-flush">
                    <!-- Card 1 -->
                    <li class="list-group-item" th:each="class : ${classes}">
                        <div class="card-body">
                            <h5 class="card-title" th:text="${class.className}">Class Title</h5>
                            <!-- <p class="card-text" th:text="${class.description}">Class Description</p> -->
                            <a th:href="'/Classes/enterClass/' + ${class.classId}" class="btn btn-primary">Enter Class</a>
                        </div>
                    </li>

                </ul>
            </div>
            <!-- End list of cards -->

            <!-- Search form -->
            <div class="input-group mt-3">
                <input type="text" class="form-control" placeholder="Search Blog..">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">
                        <span class="glyphicon glyphicon-search"></span>
                    </button>
                </span>
            </div>
            <div class="card">
    							<div class="card-body">
        							<h5 class="card-title">Class ID</h5>
        							<p class="card-text" th:text="${id}" th:data-id="${id}"></p>
        							<button class="btn btn-primary" id="copyButton">Copy ID</button>
    							</div>
							</div>
							<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
							<script>
    							var clipboard = new ClipboardJS('#copyButton', {text: function() {
        							var id = document.querySelector('.card-text').getAttribute('data-id');
            						return id;
        						}
    							});    
							</script>
							<!-- Thẻ <a> để kích hoạt modal -->
							<a th:if="${c.account.accountId == session.loggedInUser.accountId }" href="#" id="createHomeworkBtn" class="btn btn-primary">Create Homework</a>
							<a href="#" id="createNotifyBtn" class="btn btn-primary">Create Notification</a>
        </div>

        <div class="col-sm-10">
            

            <div class="tab-content">
                <!-- Tab content for Recent Posts -->
                <div id="recentPosts" class="tab-pane fade in active">                   
                   <!-- Add content for recent posts -->
                	<div class="row">                  
        				        
           				<!-- Content on the right side -->
        					
								<!-- Modal -->
								<div id="homeworkModal" class="modal">
									<div class="modal-dialog">
								    	<div class="modal-content">
								
								      	<!-- Modal Header -->
								      		<div class="modal-header">
								        		<h4 style="text-align: center" class="modal-title">Create Homework</h4>
								        		<button type="button" class="close" data-dismiss="modal">&times;</button>
								      		</div>
								
								      		<!-- Modal Body -->
								      		<div class="modal-body">
								        		<form action="/Teacher/createHomework" id="homeworkForm" method="post"  enctype="multipart/form-data">
									        		<div class="form-group">
												        <label for="classes">Class</label>
												        <select class="form-control" id="classes" name="classes">
												            <!-- Iterate over the classes and populate the options -->
												            <option th:value="${c.classId}" th:text="${c.className}"></option>
												        </select>
												    </div>
								          			<div class="form-group">
								            			<label for="homeworkName">Name:</label>
								            			<input name="homeworkName" type="text" class="form-control" id="homeworkName" required>
								          			</div>
								          			<div class="form-group">
								            			<label for="description">Description:</label>
								            			<textarea name="description" class="form-control" id="homeworkDescription" required></textarea>
								          			</div>
								          			<div class="form-group">
								            			<label for="deadline">Deadline:</label>
								            			<input name="deadline" type="date" class="form-control" id="homeworkDeadline" required>
								          			</div>
								          			<div class="form-group mt-3">
											            <label class="mr-2">Upload your homework:</label>
											            <input type="file" name="filePath">
          											</div>
								          			<button type="submit" class="btn btn-primary">Create</button>
								        		</form>
								      		</div>
								
								    	</div>
								  	</div>
								</div>
								
								<div id="notifyModal" class="modal">
									<div class="modal-dialog">
								    	<div class="modal-content">
								
								      	<!-- Modal Header -->
								      		<div class="modal-header">
								        		<h4 style="text-align: center" class="modal-title">Create Notification</h4>
								        		<button type="button" class="close" data-dismiss="modal">&times;</button>
								      		</div>
								
								      		<!-- Modal Body -->
								      		<div class="modal-body">
								        		<form action="/Teacher/createNotification" id="notifyForm" method="post"  enctype="multipart/form-data">
									        		<div class="form-group">
												        <label for="classes">Class</label>
												        <select class="form-control" id="classes" name="classes">
												            <!-- Iterate over the classes and populate the options -->
												            <option th:value="${c.classId}" th:text="${c.className}"></option>
												        </select>
												    </div>
								          			<div class="form-group">
								            			<label for="title">Title:</label>
								            			<input type="text" name="title" class="form-control" id="notifyTitle" required />
								          			</div>
								          			<div class="form-group">
								            			<label for="content">Content:</label>
								            			<textarea name="content" class="form-control" id="notifyDescription" required></textarea>
								          			</div>
								          			
								          			<div class="form-group mt-3">
											            <label class="mr-2">Upload your file(Optional):</label>
											            <input type="file" name="filePath" multiple="multiple">
          											</div>
								          			<button type="submit" class="btn btn-primary">Create</button>
								        		</form>
								      		</div>
								
								    	</div>
								  	</div>
								</div>
								<script>
								  // Lắng nghe sự kiện click vào thẻ <a> và hiển thị modal
								  document.getElementById('createHomeworkBtn').addEventListener('click', function() {
								    document.getElementById('homeworkModal').style.display = 'block';
								  });
								  
								  
								  document.getElementById('createNotifyBtn').addEventListener('click', function() {
									    document.getElementById('notifyModal').style.display = 'block';
									  });
								  
								  
								  
								
								  // Đóng modal khi nhấn vào nút đóng hoặc click bên ngoài modal
								  document.querySelectorAll('.close').forEach(function(el) {
								    el.addEventListener('click', function() {
								      document.getElementById('homeworkModal').style.display = 'none';
								    });
								  });
								  
								  document.querySelectorAll('.close').forEach(function(el) {
									    el.addEventListener('click', function() {
									      document.getElementById('notifyModal').style.display = 'none';
									    });
									  });
								  
								  
								
								  // Xử lý form submit để tạo bài tập
								  document.getElementById('homeworkForm').addEventListener('submit', function(event) {
								    
								    var name = document.getElementById('homeworkName').value;
								    var description = document.getElementById('homeworkDescription').value;
								    var deadline = document.getElementById('homeworkDeadline').value;
								
								    // Thực hiện các thao tác cần thiết để tạo bài tập, ví dụ: gửi dữ liệu đến server
								   
								
								    // Đóng modal sau khi tạo xong
								    document.getElementById('homeworkModal').style.display = 'none';
								    document.getElementById('notifyModal').style.display = 'none';								 
								  });
								  
								</script>
								
								<div id="updateNotifyModal" class="modal">
								    <div class="modal-dialog">
								        <div class="modal-content">
								            <!-- Modal Header -->
								            <div class="modal-header">
								                <h4 class="modal-title">Update Notification</h4>
												<button type="button" class="close" data-dismiss="modal">&times;</button>
								            </div>
								            <!-- Modal Body -->
								            <div class="modal-body">
								                <form id="updateNotifyForm" action="/Notify/updateNoti" method="post" enctype="multipart/form-data">
								                    <input type="hidden" id="updateNotifyId" name="notifyId">
								                    <div class="form-group">
								                        <label for="updateNotifyTitle">Title:</label>
								                        <input type="text" class="form-control" id="updateNotifyTitle" name="title">
								                    </div>
								                    <div class="form-group">
								                        <label for="updateNotifyContent">Content:</label>
								                        <textarea class="form-control" id="updateNotifyContent" name="content"></textarea>
								                    </div>
								                    <div class="form-group mt-3">
												        <label class="mr-2">Current Files:</label>
												        <div>
												            <ul>
														        <li th:each="fileName : ${noti.filePath}">
														            <a th:href="@{'/downloadFile/' + ${fileName}}" th:text="${fileName}">Download</a>
														        </li>
												    		</ul>
												        </div>
												    </div>
								                    <div class="form-group mt-3">
													<label class="mr-2">Upload your file(Optional):</label>
														<input type="file" name="filePath" multiple="multiple">
								          			</div>
								                    <button type="submit" class="btn btn-primary">Update</button>
								                </form>
								            </div>
								        </div>
								    </div>
								</div>
								<script>
									function openUpdateNotifyModal(notifyId, notifyTitle, notifyContent) {
									    // Điền dữ liệu vào các trường trong modal
									    document.getElementById('updateNotifyId').value = notifyId;
									    document.getElementById('updateNotifyTitle').value = notifyTitle;
									    document.getElementById('updateNotifyContent').value = notifyContent;
									    
									    // Mở modal
									    $('#updateNotifyModal').modal('show');
									    
									    document.querySelectorAll('.close').forEach(function(el) {
										    el.addEventListener('click', function() {
										    	$('#updateNotifyModal').modal('hide');
										    });
										  });
									    
										};																    
								</script>							
				
				
				
				
								
	    
    						</div>
    						<div class="col-md-10">
	<!-- Content on the right side -->
    <h2><span th:text="${noti.title}"></span></h2>
    <div th:if="${noti.account.accountId == session.loggedInUser.accountId }">
    	<a href="#" class="btn btn-primary" 
       		data-toggle="modal" data-target="#updateNotifyModal"
       		th:attr="onclick='openUpdateNotifyModal(\'' + ${noti.notifyId} + '\', \'' + ${noti.title} + '\', \'' + ${noti.content} + '\')'">
       		
       		Cập nhật thông báo
    	
    	</a>
    	<a th:attr="onclick='confirmDelete(\'' + ${noti.notifyId} + '\')'" class="btn btn-danger btn-xs"><span class="glyphicon glyphicon-remove"></span> Delete</a>
    </div>
            
    <script>
	    function confirmDelete(notifyId) {
	        var result = confirm("Are you sure you want to delete this notify?");
	        if (result) {
	            // User clicked 'Yes', redirect to the delete URL
	            window.location.href = "/Teacher/deleteNoti/" + notifyId;
	        } else {
	            // User clicked 'No', do nothing
	        }
	    }
	</script>
    <h5><span class="glyphicon glyphicon-time"></span> Post by <span th:text="${noti.account.displayName}"></span>, <span th:text="${#temporals.format(noti.dateCreated, 'dd/MM/yyyy HH:mm')}"></span>
    .</h5>
    <h5 th:if="${noti.lastModifed != null}"><span class="glyphicon glyphicon-time"></span> Last modified <span th:text="${#temporals.format(noti.lastModifed, 'dd/MM/yyyy HH:mm')}"></span></h5>
	<h5><span class="label label-danger">Food</span> <span class="label label-primary">Ipsum</span></h5><br>
	<span th:text="${noti.content}"></span>
	<!-- Check if filePath is not empty -->
   	<div >
		<!-- <a th:href="@{'/downloadFile/' + ${noti.filePath}}" th:text="${noti.filePath}">Download</a><!-- You can modify the link text and URL as needed -->
		 <ul>
        <li th:each="fileName : ${listFile}">
    <a th:href="${fileName.filePath}" th:text="${fileName.filePath.replaceFirst('.*_Notify_', '')}"></a>
        </li>
    </ul>
	</div>
	<br><br>
	<h4>Leave a Comment:</h4>
    <form role="form" action="/Comment/createNotifyComment" method="post">
    	<div class="form-group">
	    	<input name="notify" th:value="${noti.notifyId}" hidden="true" class="form-control" rows="3" required />
	    </div>
	    <div class="form-group">
	       <textarea name="content" class="form-control" rows="3" required></textarea>
	    </div>
	    <button type="submit" class="btn btn-success">Submit</button>
	</form>
	<br><br>
    <p><span class="badge" th:text="${noti.numComment}"></span> Comments:</p><br>
    <div class="row">
    	<div th:each="cmt : ${listComment}" th:if="${noti.notifyId == cmt.notify.notifyId }" class="comment">
    	<div class="col-sm-2 text-center">
        	<img th:src="@{'/image/getImage/' + ${cmt.account.image}}" class="img-circle" height="65" width="65" alt="Avatar">
    	</div>
  		<div class="col-sm-10">
        	<h4><span th:text="${cmt.account.displayName}"></span> <small><span th:text="${#temporals.format(cmt.dateCreated, 'dd/MM/yyyy HH:mm')}"></span></small></h4>
        	<p class="original-content" th:text="${cmt.content}"></p>
        	<textarea class="edit-content" style="display: none;"></textarea>
        	<div class="btn-group">	
				<a href="#" th:if="${#lists.contains(checkLikeComment, cmt.commentId)}"
			   		th:id="'likeButton_' + ${cmt.commentId}" 
			   		th:data-comment-id="${cmt.commentId}"
			   		class="like-btn liked" 
			   		th:attr="onclick='toggleLike(\'' + ${cmt.commentId} + '\', event)'">
			    	<i class="fa fa-thumbs-up"></i>Liked<span th:if="${cmt.likeNumber != null or cmt.likeNumber != 0}">(</span><span th:if="${cmt.likeNumber != null or cmt.likeNumber != 0}" th:text="${cmt.likeNumber}"></span><span th:if="${cmt.likeNumber != null or cmt.likeNumber != 0}">)</span>
				</a>
				<a href="#" th:unless="${#lists.contains(checkLikeComment, cmt.commentId)}"
				   th:id="'likeButton_' + ${cmt.commentId}" 
				   th:data-comment-id="${cmt.commentId}"
				   class="like-btn" 
				   th:attr="onclick='toggleLike(\'' + ${cmt.commentId} + '\', event)'">
				   <i class="fa fa-thumbs-up"></i>Like<span th:if="${cmt.likeNumber != null or cmt.likeNumber != 0}">(</span><span th:if="${cmt.likeNumber != null or cmt.likeNumber != 0}" th:text="${cmt.likeNumber}"></span><span th:if="${cmt.likeNumber != null or cmt.likeNumber != 0}">)</span>
				</a>

				<script th:inline="javascript">			    
				    function toggleLike(commentId, event) {
				        event.preventDefault(); // Ngăn chặn hành vi mặc định của thẻ <a>			        
				        var likeButton = document.getElementById('likeButton_' + commentId);
				        var isLiked = likeButton.classList.contains('liked');			        
				        fetch('/Comment/likeComment/' + commentId, { method: 'GET' })
				        .then(response => {
				            if (!response.ok) {
				                throw new Error('Failed to like/unlike comment');
				            }			            
				            // Thay đổi nút từ Like sang Liked và ngược lại
				            if (isLiked) {
				                likeButton.innerHTML = '<i class="fa fa-thumbs-up"></i>Like';
				                likeButton.classList.remove('liked');
				            } else {
				                likeButton.innerHTML = '<i class="fa fa-thumbs-up"></i>Liked';
				                likeButton.classList.add('liked');
				            }			            
				            console.log('Comment like/unlike successful');
				        })
				        .catch(error => {
				            console.error('Error:', error);
				        });
				    }			
				</script>       	
    			<a th:if="${cmt.account.accountId == session.loggedInUser.accountId}"  th:data-comment-id="${cmt.account.email}" href="#" class="edit-btn">
                	<i class="fa fa-pencil"></i> Edit
            	</a>
				<a href="#" class="save-btn" style="display: none;" th:data-comment-id="${cmt.commentId}"><i class="fa fa-save"></i> Save</a>
				<a href="#" class="cancel-btn" style="display: none;">Cancel</a>			
				<a href="#" th:if="${cmt.account.accountId == session.loggedInUser.accountId }" th:attr="onclick='confirmDeleteComment(\'' + ${cmt.commentId} + '\')'" ><i class="fa fa-trash"></i>Delete</a>   	 		
   				<a href="#" class="reply-btn">Reply</a>
				<form th:action="@{/Comment/createReplyComment}" method="post" class="reply-form" style="display: none;">
    <input name="comment" th:value="${cmt.commentId}" hidden="true" class="form-control" />
    <textarea name="content" class="reply-content" rows="3" required></textarea>
    <button type="submit" class="btn btn-primary">Submit</button>
    <!-- Thêm nút Cancel -->
    <button type="button" class="btn btn-secondary cancell-btn">Cancel</button>
</form>
<script>
	    function confirmDeleteComment(commentId) {
	        var result = confirm("Are you sure you want to delete this comment?");
	        if (result) {
	            // User clicked 'Yes', redirect to the delete URL
	            window.location.href = "/Comment/deleteComment/" + commentId;
	        } else {
	            // User clicked 'No', do nothing
	        }
	    }
	</script>
<script>
    $(document).ready(function() {
        $('.reply-btn').click(function(event) {
            event.preventDefault(); // Ngăn chặn hành vi mặc định của thẻ <a>

            // Hiển thị form Reply tương ứng
            var $comment = $(this).closest('.comment');
            $comment.find('.reply-form').show();
        });

        // Ẩn form khi nhấn nút Cancel
        $('.cancell-btn').click(function(event) {
            event.preventDefault();
            var $comment = $(this).closest('.comment');
            $comment.find('.reply-form').hide();
        });
    });

    // Hàm gửi dữ liệu reply comment lên server bằng Ajax
    function createReplyComment(content, commentId) {
        $.ajax({
            type: 'POST',
            url: '/Comment/createReplyComment',
            data: { content: content, commentId: commentId },
            success: function(response) {
                // Xử lý sau khi reply comment được tạo thành công (nếu cần)
                console.log('Reply comment created successfully');
                // Có thể làm mới danh sách comment ở đây nếu cần
            },
            error: function(xhr, status, error) {
                // Xử lý lỗi nếu có
                console.error('Error creating reply comment:', error);
            }
        });
    }
</script>
				

    		
    		</div>
        	<br>
    	</div>
    	
    	<div style="padding-left: 100px">
		<!-- <p><span class="badge">1</span> Comment:</p><br> -->	
	          <div th:each="reply : ${listReply}" th:if="${reply.comment.commentId == cmt.commentId}" class="row">	          
		          <div class="col-sm-2 text-center">
		          	<img th:src="@{'/image/getImage/' + ${reply.account.image}}" class="img-circle" height="65" width="65" alt="Avatar">
		          </div>
		           <div class="col-xs-10">
		             <h4><span th:text="${reply.account.displayName}"></span> <small><span th:text="${#temporals.format(reply.dateCreated, 'dd/MM/yyyy HH:mm')}"></span></small></h4>
		             <p><span th:text="${reply.content}"></span></p>
		             
		             <div th:if="${reply.account.accountId == session.loggedInUser.accountId }" class="btn-group">
		             	<a href="#"><span class="fa fa-thumbs-up"></span>Like</a>
		             	<a href="#"><span class="fa fa-pencil"></span>Edit</a>
		             	<a href="#"><span class="fa fa-trash"></span>Delete</a>
		             </div>
		           </div>
	          </div>
		</div>
	</div>
			
	          

	<script>
	$(document).ready(function() {
	    $('.edit-btn').click(function(event) {
	        event.preventDefault(); // Ngăn chặn hành vi mặc định của liên kết
	        // Ẩn nội dung ban đầu và hiển thị textarea để chỉnh sửa
	        var $comment = $(this).closest('.comment');
	        $comment.find('.original-content').hide();
	        $comment.find('.edit-content').show().val($comment.find('.original-content').text().trim());
	        $comment.find('.save-btn').show();
	        $comment.find('.cancel-btn').show();
	    });
		
	    $('.cancel-btn').click(function(event) {
	        event.preventDefault(); // Ngăn chặn hành vi mặc định của liên kết
	        var $comment = $(this).closest('.comment');
	        $comment.find('.edit-content').hide();   
	        $comment.find('.cancel-btn').hide();
	        $comment.find('.save-btn').hide();
	    });
	    
	    
	    $('.save-btn').click(function(event) {
	        event.preventDefault(); // Ngăn chặn hành vi mặc định của liên kết
	        var $comment = $(this).closest('.comment');
	        var commentId = $(this).data('comment-id');
	        var updatedContent = $comment.find('.edit-content').val().trim();
	
	        // Gửi yêu cầu cập nhật nội dung bình luận bằng Ajax
	        $.ajax({
	            type: 'POST',
	            url: '/Comment/updateComment/' + commentId,
	            data: { content: updatedContent },
	            success: function(response) {
	                // Xử lý phản hồi từ máy chủ nếu cần
	                // Ví dụ: Hiển thị thông báo hoặc làm mới danh sách bình luận
	                console.log('Comment updated successfully');
	                // Ẩn textarea chỉnh sửa và hiển thị lại nội dung mới
	                $comment.find('.edit-content').hide();
	                $comment.find('.original-content').text(updatedContent).show();
	                // Ẩn nút Save
	                $comment.find('.save-btn').hide();
	            },
	            error: function(xhr, status, error) {
	                // Xử lý lỗi nếu cần
	                console.error('Error updating comment:', error);
	            }
	        });
	    });
	});
	</script>   
	</div>
</div>	 
    						
    						
    						
                </div>

                
                
                

            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('#copyButton', {
        text: function() {
            var id = document.querySelector('.card-text').getAttribute('data-id');
            return id;
        }
    });
</script>












<div th:replace="/ViewLayout/footer.html"></div>
